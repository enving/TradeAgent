name: Deploy TradeAgent

on:
  workflow_dispatch:  # Manual trigger

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.12'

      - name: Create .env from secrets
        run: |
          cat > .env << EOF
          ALPACA_API_KEY=${{ secrets.ALPACA_API_KEY }}
          ALPACA_SECRET_KEY=${{ secrets.ALPACA_SECRET_KEY }}
          SUPABASE_URL=${{ secrets.SUPABASE_URL }}
          SUPABASE_KEY=${{ secrets.SUPABASE_KEY }}
          OPENROUTER_API_KEY=${{ secrets.OPENROUTER_API_KEY }}
          NEWS_API_KEY=${{ secrets.NEWS_API_KEY }}
          FINNHUB_API_KEY=${{ secrets.FINNHUB_API_KEY }}
          ALPHA_VANTAGE_API_KEY=${{ secrets.ALPHA_VANTAGE_API_KEY }}
          ENABLE_LLM_FEATURES=true
          EOF

      - name: Install dependencies
        run: |
          pip install -r requirements.txt

      - name: Run trading bot
        run: |
          python3 -m src.main
